<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <title>API Reference</title>

    <link href="stylesheets/override.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="javascripts/all.js" type="text/javascript"></script>

  </head>

  <body class="index">
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="search">
          <input type="text" class="search" id="input-search">
        </div>
        <div class="search-info"></div>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='#'>Sign Up for a Developer Key</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the SilkCloud Commerce Platform.</p>

<h1 id="overview">Overview</h1>

<h1 id="api-reference">API Reference</h1>

<p>Here are the resources supported by SilkCloud.</p>

<ul>
<li><a href="api-docs/#country">Countries</a></li>
<li><a href="api-docs/#currency">Currencies</a></li>
<li><a href="api-docs/#locale">Locales</a></li>
</ul>

          <h1 id="getting-started">Getting Started</h1>

<h2 id="determine-the-environment">Determine the Environment</h2>

<p>There are two main environments in the commerce system:</p>

<ul>
<li>Sandbox Environment. This environment is for integration testing. Testers can try the APIs in the sandbox environment. No real transactions will happen by calling to the sandbox environment. The data in the sandbox environment is fake/mock data.</li>
<li>Production Environment. This environment is for the production. Any call to this environment is a real transaction.</li>
</ul>

<p>To get started, you can use Sandbox Environment. The URLs for the environments are listed below:</p>

<table><thead>
<tr>
<th>Environment</th>
<th>URL</th>
</tr>
</thead><tbody>
<tr>
<td>Sandbox</td>
<td>TBD https://apis.sandbox.silkcloud.com/</td>
</tr>
<tr>
<td>Production</td>
<td>TBD https://apis.silkcloud.com/</td>
</tr>
</tbody></table>

<h2 id="obtaining-the-app-client">Obtaining the App Client</h2>

<p>The commerce platform uses the OAuth 2.0 as the authorization protocol. In OAuth 2.0, any code calling the APIs are called a client. Clients must be registered first in order to make an API call. After registering, the client gets back their OAuth client ID and client secret. (TBD: Identify client using certificate)
You can start with the following test client ID for sandbox environment while applying for your new client ID. This test client ID has all normal permissions to all APIs. After obtaining the client ID for your application, please switch to validate the permissions you get can still make the calls.</p>

<table><thead>
<tr>
<th>Test Client ID</th>
<th>Client Secret</th>
</tr>
</thead><tbody>
<tr>
<td>test_csr</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_first_party_backend</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_first_party_client</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_first_party_server</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_super_client</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_third_party_backend</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_third_party_client</td>
<td>weakClientSecret123</td>
</tr>
<tr>
<td>test_third_party_server</td>
<td>weakClientSecret123</td>
</tr>
</tbody></table>

<p>The difference of first-party vs third-party is TBD. We’ll first let first-party call almost all APIs to enable implementing the single-page frontend web applications.</p>

<p>To get your own application client ID, refer to the following section: TBD</p>

<h2 id="making-api-calls">Making API Calls</h2>

<p>In the getting started section, we will demonstrate how to get the user information. We will use the test_first_party_client as the OAuth client ID.</p>

<p>Note: This section assumes the user login portal is already available. How to write a login portal is covered in TBD.</p>

<h2 id="sign-in-the-user">Sign-in the User</h2>

<p>Let the user sign-in and get the OAuth authorization code.</p>
<pre class="highlight shell">curl -X POST --max-redirs 0 <span class="se">\</span>
     <span class="s2">"</span><span class="nv">$baseUri</span><span class="s2">/oauth2/authorize?client_id=test_first_party_client&amp;redirect_uri=http://localhost/some_sample_page&amp;response_type=code"</span>
</pre>

<p><strong>Note</strong>: /authorize is not a typical REST API according to OAuth protocol.</p>

<p>In the curl command:</p>

<ul>
<li>$baseUri should be replaced with the URL of your target environment. For sandboxing environment, the value is https://apis.sandbox.silkcloud.com/</li>
<li>The client_id is specified in the request. You will need to use the client secret in of the specified client_id in order to get the access token.</li>
<li>The redirect_uri in the request determines how the auth flow will respond to you when then authorization flow has finished. The browser will redirect to the redirect_uri when the flow finishes, with the auth code in the query string. For example:

<ul>
<li>Response Code: 302</li>
<li>Location: <code class="prettyprint">http://localhost/some_sample_page?code=someBase64AuthCode</code></li>
</ul></li>
<li>A special redirect_uri can be specified to get a json object (maybe after some 302 redirects). For example:

<ul>
<li>Response Code: 200</li>
<li>Payload: </li>
</ul></li>
</ul>
<pre class="highlight http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>

<span class="p">{</span><span class="w">
    </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"someBase64AuthCode"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Here is what happens in this step:</p>

<ul>
<li>The user is redirected to the identity portal.</li>
<li>The user can sign-in, sign-up or silent sign-in with cookie in the identity portal.</li>
<li>Then the auth server will then issue an authorization code.</li>
<li>The auth server will redirect the client to the specified redirect_uri with the authorization code in the query string.</li>
</ul>

<p>To perform silent sign-in without redirecting the whole page, the client can always perform POST /authorize with prompt=none first to know whether the user is signed in or not. In the OAuth 2.0 standard, the /authorize endpoint can take a query parameter: prompt=none. When this is specified, the user will not be redirected to the login html. If the silent sign-in is applicable with the cookie, the user is signed in directly. Otherwise the server redirects back with an error in query string.</p>

<p>There are some more details on how to handle the silent sign-in and how to login without redirecting out to another page are covered in TBD section. We will ignore them here. TBD: the client should wrap these steps to a client SDK?</p>

<p>As a successful result of this step, the client can get the authorization code through either query string or json. The authorization code is effective for a short period.</p>

<h2 id="get-the-oauth-access-token">Get the OAuth Access Token</h2>

<p>The client can get the access token base using the authorization code plus the client secret.</p>
<pre class="highlight shell">curl -X POST <span class="se">\</span>
     -H <span class="s2">"Authorization: Basic dGVzdF9maXJzdF9wYXJ0eV9jbGllbnQ6d2Vha0NsaWVudFNlY3JldDEyMw=="</span> <span class="se">\</span>
     -H <span class="s2">"Content-Type: application/x-www-form-urlencoded"</span> <span class="se">\</span>
     <span class="s2">"</span><span class="nv">$baseUri</span><span class="s2">/oauth2/token"</span> <span class="se">\</span>
     -d <span class="s2">"redirect_uri=http://localhost/some_sample_page&amp;grant_type=authorization_code&amp;code=someBase64AuthCode"</span>
</pre>

<p>In the curl command:</p>

<ul>
<li>The Authorization: Basic header contains the base 64 encoded client_id:client_secret pair.</li>
<li>The redirect_uri must be the same as the one used in the initial /authorize call.</li>
<li>The grant_type must be authorization_code.</li>
<li>The code is the authorization code returned in the first step.</li>
</ul>

<p>The response will be:</p>
<pre class="highlight http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>

<span class="p">{</span><span class="w">
    </span><span class="s2">"access_token"</span><span class="p">:</span><span class="s2">"someBase64AccessToken"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"token_type"</span><span class="p">:</span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"expires_in"</span><span class="p">:</span><span class="mi">3600</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>The &ldquo;expires_in&rdquo; in the response indicates that the access token expires in 1 hour. This is configurable per client through the server-side policy. When the access token is about to expire, the client can use silent sign-in in javascript to get a new access token.Some notes on the client id type and the client secret. The client secret used by client&rsquo;s single-page applications should be considered insecure. They can be stolen and used to create a different web application. For such client IDs, they cannot have any permission that requires a trusted caller. For example, they cannot call fulfillment APIs directly. They must call place order and the server can make the fulfillment for them. In these scenarios, having the client secret here is just to follow the OAuth protocol. For third-party server, they may really store and use the access token only from their server. In that case, the client secret will never show in their client application.</p>

<p>The access token can be used to call any APIs allowed by the user signed in. For example, the access token can be used to get the user profile of the signed in user. Or it can be used to update user profile of the signed in user. But it cannot be used to update the user profile of an irrelevant user. There can be special rules in the APIs. They are defined in the API docs.</p>

<h2 id="call-the-api">Call the API</h2>

<p>After getting the access token, you can add the header &ldquo;Authorization: Bearer <accessToken>&rdquo; to call the APIs. The APIs needs to be in the scope of the access token. Otherwise 401 will be returned. If the token is revoked or expired, 401 will also be returned. The application needs to be prepared to handle 401 error and try sign-in again anywhere.</p>

<p>For example, to get the user, the client can call:</p>
<pre class="highlight shell">curl -X GET -H <span class="s2">"Authorization: Bearer someBase64AccessToken"</span> <span class="s2">"</span><span class="nv">$baseUri</span><span class="s2">/v1/users/6B54FFB83C9F"</span>
</pre>

<p>The response will be:</p>
<pre class="highlight http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-store</span>
<span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span>

<span class="p">{</span><span class="w">
  </span><span class="s2">"self"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/users/6B54FFB83C9F"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"liangfuxia"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"preferredLocale"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en_US"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"preferredTimeZone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UTC+08:00"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"isAnonymous"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"addresses"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/addresses/6C54FEB83D9F "</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6C54FEB83D9F"</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"phones"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/phones/3B54BFE43C9F"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3B54BFE43C9F"</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"emails"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/emails/6B54EEB43D6F"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"6B54EEB43D6F"</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ACTIVE"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"fullName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John H Smith"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"givenName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"middleName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"H"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"familyName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"nickname"</span><span class="p">:</span><span class="s2">"SmithHoney"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"birthday"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1993-01-01"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"gender"</span><span class="p">:</span><span class="s2">"MALE"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"futureExpansion"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="s2">"rev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1-k930dkd03kdk3k3k5"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"createdTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2013-01-01T01:32:53Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"updatedTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2013-01-01T01:32:53Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"groupMemberships"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/groups?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"devices"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/devices?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"authenticators"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/authenticators?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"tosAgreements"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/users/6B54FFB83C9F/tos-agreements"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/users/6B54FFB83C9F/credentials"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"credentialAttempts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/credential-attempts?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"optIns"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/opt-ins?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"securityQuestions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/users/6B54FFB83C9F/security-questions"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"securityQuestionAttempts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/users/6B54FFB83C9F/security-question-attempts"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"paymentInstruments"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/payment-instruments?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"orders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/orders?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"carts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/users/6B54FFB83C9F/carts"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"entitlements"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/v1/entitlements?userId=6B54FFB83C9F"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

          <h1 id="domain-object-model">Domain Object Model</h1>

<p><a href="static/model.pdf">Click here</a> for a comprehensive diagram of the different objects within the SilkCloud system.</p>

          <h1 id="registration,-login-and-authentication">Registration, Login and Authentication</h1>

<h2 id="overview">Overview</h2>

<p>The identity system manages all user credentials, account profile information, and the access to different resources.  This section covers the two fundamental concepts: user profile management and authentication.  For information around how different user relationships are managed please check User Management.</p>

<h2 id="user-profile-management">User profile management</h2>

<p>The minimal information required to register/create a new user account within the platform is just user name and password.  Alternatively user can login using third party identities such as Sina ID, Google ID, etc.  Integration with local third party identity systems can be added per request.  Please reach out to SilkCloud for further information.</p>

<p>Once logged in user can fill in supplemental information, such as addresses, privacy settings, security settings, etc. to complete his profile. The standard user profile elements include : </p>

<ul>
<li>ADDRESS</li>
<li>NAME</li>
<li>EMAIL</li>
<li>PHONE</li>
<li>DOB</li>
<li>SMS</li>
<li>QQ</li>
<li>WHATSAPP</li>
<li>PASSPORT - e.g., “USA 123456789”</li>
<li>GOVERNMENT_ID - SSN or equivalent in other countries.</li>
<li>DRIVERS_LICENSE - e.g., “USA CA 12345”</li>
<li>GENDER</li>
</ul>

<p>Customized user profile elements can be added per request.</p>

<h2 id="authentication">Authentication</h2>

<p>This is the process for the server to check user access to platform resources.  Depending on where and when the authentication happens there are 3 typical authentication processes:</p>

<h3 id="login-authentication">Login Authentication</h3>

<p>This is the standard process in which server checks user login credentials and grant standard privileges.  The system supports both first party login credentials and third party logins such as Sina ID Login, Google ID login,  etc.  First party authentication returns results immediately.  Third party logins redirect user to external ID system.</p>

<h3 id="access-rights-authentication">Access rights authentication</h3>

<p>After login a user may attempt to access resources that are protected by escalated security measures. For example a user logs in to change his password.  However change password is not within standard privilege granted by the login authentication process. So client has to perform authentication again to require higher level privileges.  </p>

<p>Within the access rights authentication process server may respond with special security measures such as password reentry or two-factor authentications.  User has to pass these additional challenges to be successfully authenticated for higher privileges.  The security measures are pre-defined during client onboarding process.  For more information please check User Identity Protection.</p>

<p>Another scenario that requires access right authentication is when user attempts to perform functions that require special roles.  Similarly since these functions are not within standard privileges an authentication request is needed.  The server checks user&rsquo;s role assignment to determine whether access to the function is allowed.  Please check Authorizations for more details on how to manage user roles and rights on the platform.</p>

<h3 id="oauth2">OAuth2</h3>

<p>Authentication for third party server to obtain access token to platform APIs.
OAuth2 and its extension OpenId Connect Protocol (http://openid.net/connect/) is implemented.</p>

<h2 id="end-to-end-flows">End to End Flows</h2>

<h3 id="user-registration-using-a-browser-(account-creation)">User registration using a browser (Account creation)</h3>

<ol>
<li>User clicks on create new account which triggers an authentication request to be sent to the Auth server.</li>
<li>The Auth Server responds with view &ldquo;register&rdquo;, requiring  browser redirection to the Registration Page.</li>
<li>Browser displays the registration page.  If  the server response includes requirement to show reCAPTCHA browser also needs to display the reCAPTCHA together with the registration form.</li>
<li>User inputs information required for registration and browser sends another authentication request to server to create new user account.</li>
<li>Step 2-4 is repeated, until the Auth Server returns 302.</li>
<li>The registration page redirects back to the auth Server.</li>
<li>The Auth Server finally redirects back to the application&rsquo;s callback URL</li>
</ol>

<h3 id="user-login-using-a-browser">User login using a browser</h3>

<ol>
<li>An user attempts to access a function that requires user to login or gather explicit consent.  Due to the privilege level needed, client sends an authentication request to the Auth Server.</li>
<li>The Auth Server responds with view &ldquo;login&rdquo;, requiring  browser redirection to the login Page.

<ul>
<li>Auth server may also respond with view &ldquo;Challenge&rdquo; then browser needs to redirect to the challenge page.  For more details please check User Identity Protection</li>
<li>Auth server may respond with view &ldquo;consent&rdquo;, then browser needs to shows  UI for the user to confirm granting access .</li>
</ul></li>
<li>Browser displays the required view.</li>
<li>Browser collects user inputs and sends another authentication request to the server.</li>
<li>Step 2-4 is repeated, until the Auth Server returns 302.</li>
<li>The login page redirects back to the Auth Server.</li>
<li>The Auth Server finally redirects back to the application&rsquo;s callback URL</li>
</ol>

<h2 id="sample-code">Sample Code</h2>

<h3 id="authentication-request-triggers-a-view-to-display-registration-view-with-recaptcha-challenge">Authentication request triggers a view to display registration view with reCAPTCHA challenge</h3>

<p>Sample Request</p>
<pre class="highlight http"><span class="nf">POST</span> <span class="nn">/connect/authorize?fs=oEYLTZnI0N</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s"> Content-Type: application/json</span>
<span class="s"> Accept: application/json</span>
<span class="s"> Host: auth.silkcloud.com</span>

 {
 }
</pre>

<p>Sample Response</p>
<pre class="highlight http"><span class="err"> </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">Ok</span>
<span class="s"> Content-Type: application/json</span>
<span class="s"> Cache-Control: no-store</span>
<span class="s"> Pragma: no-cache</span>
<span class="s"> {</span>
<span class="s">  "view": "register",</span>
<span class="s">  "model": {</span>
<span class="s">    "clientId": "s6BhdRkqt3",</span>
<span class="s">    "locales": "en_US",</span>
<span class="s">    "theme": "default",</span>
<span class="s">    "recaptchaImageUrl": "http://blablabla"</span>
<span class="s">    ...</span>
<span class="s">  }</span>
<span class="s"> }</span>
</pre>

<h3 id="user-registration-information-collected-and-sent-to-the-auth-server">User registration information collected and sent to the Auth server</h3>

<p>Sample Request</p>
<pre class="highlight http"><span class="nf">POST</span> <span class="nn">/connect/authorize?fs=oEYLTZnI0N</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s"> Content-Type: application/json</span>
<span class="s"> Accept: application/json</span>
<span class="s"> Host: auth.silkcloud.com</span>

 {
 "event": "next"
 "model": {
  "username": "user1@silkcloud.com",
  "password": "password",
  "dob": "…",
  …
 }
 }
</pre>

<p>Sample Response (GOOD)</p>
<pre class="highlight http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span>
<span class="s"> Location: https://auth.silkcloud.com/connect/authorize?fs=oEYLTZnI0N</span>
</pre>

<p>Sample Responese (BAD)</p>
<pre class="highlight http"><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">400</span> <span class="ne">Bad Request</span>
<span class="s"> Content-Type: application/json</span>
<span class="s"> Cache-Control: no-store</span>
<span class="s"> Pragma: no-cache</span>

 {
  "code": "10123",
  "message": "some error happens",
 }
</pre>

<h3 id="authentication-request-triggers-a-login-view">Authentication request triggers a login view</h3>

<h4 id="sample-request">Sample Request</h4>
<pre class="highlight http"><span class="nf">POST</span> <span class="nn">/connect/authorize?fs=oEYLTZnI0N</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="s"> Content-Type: application/json</span>
<span class="s"> Accept: application/json</span>
<span class="s"> Host: auth.silkcloud.com</span>
<span class="s">  {</span>
<span class="s"> }</span>
</pre>

<p>#### Sample Response</p>
<pre class="highlight http"><span class="err"> </span><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">Ok</span>
<span class="s"> Content-Type: application/json</span>
<span class="s"> Cache-Control: no-store</span>
<span class="s"> Pragma: no-cache</span>
<span class="s">  {</span>
<span class="s">  "view": "login",</span>
<span class="s">  "model": {</span>
<span class="s"> "clientId": "s6BhdRkqt3",</span>
<span class="s"> "locales": "en_US",</span>
<span class="s"> "theme": "default",</span>
<span class="s"> ...</span>
<span class="s">  }</span>
<span class="s"> }</span>
</pre>

<p>### Browser collects user login credential and request authentication</p>

<ul>
<li>GOOD response: Server response with requirement to gather user consent (&ldquo;consent&rdquo; view) </li>
<li>BAD response: login fails due to invalid username or password.</li>
</ul>

<p>#### Sample Request
 &ldquo;`http
 POST /connect/authorize?fs=oEYLTZnI0N HTTP/1.1
 Content-Type: application/json
 Accept: application/json
 Host: auth.silkcloud.com</p>

<p>{
 &quot;event&rdquo;: &ldquo;next&rdquo;
 &ldquo;model&rdquo;: {
  &ldquo;username&rdquo;: &ldquo;user1@silkcloud.com&rdquo;
  &ldquo;password&rdquo;: &ldquo;password&rdquo;
 }
 }
 &ldquo;`</p>

<p>#### Sample Response (GOOD)
 &rdquo;`http
 HTTP/1.1 200 Ok
 Content-Type: application/json
 Cache-Control: no-store
 Pragma: no-cache</p>

<p>{
  &ldquo;view&rdquo;: &ldquo;consent&rdquo;,
  &ldquo;model&rdquo;: {
 &ldquo;clientId&rdquo;: &ldquo;s6BhdRkqt3&rdquo;,
 &ldquo;locales&rdquo;: &ldquo;en_US&rdquo;,
 &ldquo;theme&rdquo;: &ldquo;default&rdquo;,
 &ldquo;scopes&rdquo;: &ldquo;email profile &hellip;&rdquo;
 &hellip;
  }
 }
 &ldquo;`</p>

<p>#### Sample Response (BAD)
 &rdquo;`http
 HTTP/1.1 400 Bad Request
 Content-Type: application/json
 Cache-Control: no-store
 Pragma: no-cache</p>

<p>{
  &ldquo;code&rdquo;: &ldquo;10123&rdquo;,
  &ldquo;message&rdquo;: &ldquo;username or password is invalid&rdquo;,
 }
 &ldquo;`</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
